{"version":3,"file":"popup.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACxDA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://youtube-sort-by-likes/./src/js/api.js","webpack://youtube-sort-by-likes/./src/js/constants.js","webpack://youtube-sort-by-likes/./src/js/utils.js","webpack://youtube-sort-by-likes/webpack/bootstrap","webpack://youtube-sort-by-likes/webpack/runtime/define property getters","webpack://youtube-sort-by-likes/webpack/runtime/hasOwnProperty shorthand","webpack://youtube-sort-by-likes/webpack/runtime/make namespace object","webpack://youtube-sort-by-likes/./src/js/popup.js"],"sourcesContent":["import { API_KEY, MAX_RESULTS, USE_MOCK_DATA } from './constants.js';\r\nimport { getCachedData, cacheData } from './utils.js';\r\n\r\nasync function getVideos(channelId, use_mock_data = USE_MOCK_DATA) {\r\n  // Try to get the videos from the cache\r\n  const cachedVideos = await getCachedData(channelId);\r\n  if (cachedVideos) {\r\n    return cachedVideos;\r\n  }\r\n\r\n  const response = await fetch(\r\n    `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${channelId}&part=snippet,id&order=viewCount&maxResults=${MAX_RESULTS}`\r\n  );\r\n  const data = await response.json();\r\n  console.log(\"Request successful\");\r\n  const videos = data.items.filter((item) => item.id.kind === \"youtube#video\");\r\n  \r\n  // Cache the videos for future use\r\n  await cacheData(channelId, videos);\r\n\r\n  return videos;\r\n}\r\n\r\n\r\nfunction getVideoStats(videoId, use_mock_data = USE_MOCK_DATA) {\r\n  return fetch(\r\n    `https://www.googleapis.com/youtube/v3/videos?key=${API_KEY}&id=${videoId}&part=statistics`\r\n  )\r\n    .then((response) => response.json())\r\n    .then((data) => data.items[0].statistics);\r\n}\r\n\r\n\r\nfunction getChannelIdByUsername(username, use_mock_data = USE_MOCK_DATA) {\r\n\r\n  if (use_mock_data) {\r\n    return Promise.resolve(\"samharrisorg\");\r\n  }\r\n\r\n  console.log(\"username: \", username);\r\n  console.log(`https://www.googleapis.com/youtube/v3/channels?key=${API_KEY}&forUsername=${username}&part=id`);\r\n\r\n  return fetch(\r\n    `https://www.googleapis.com/youtube/v3/channels?key=${API_KEY}&forUsername=${username}&part=id`\r\n  )\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      console.log(\"data: \", data);\r\n      if (data.items.length > 0) {\r\n        return data.items[0].id;\r\n      } else {\r\n        throw new Error('No channel found with this username');\r\n      }\r\n    });\r\n}\r\n\r\nexport { getVideos, getVideoStats, getChannelIdByUsername };\r\n","// replace with your own YouTube API key\r\nconst API_KEY = \"AIzaSyCH3y1_3XlxueC-ecNYfTcHOlTxtOiwL1o\"; \r\nconst MAX_RESULTS = 25;\r\nconst USE_MOCK_DATA = false;\r\nexport { API_KEY, MAX_RESULTS, USE_MOCK_DATA };\r\n","import { getChannelIdByUsername } from './api.js';\r\n\r\nfunction getChannelId(url) {\r\n  if (url.hostname === 'www.youtube.com' && url.pathname.startsWith('/channel/')) {\r\n    return Promise.resolve(url.pathname.split('/channel/')[1]);\r\n  } else if (url.hostname === 'www.youtube.com' && url.pathname.startsWith('/@')) {\r\n    let username = url.pathname.split('/@')[1].split('/videos')[0];\r\n    return getChannelIdByUsername(username);\r\n  } else {\r\n    throw new Error('URL is not a YouTube channel URL');\r\n  }\r\n}\r\n\r\nfunction decodeHtml(html) {\r\n  var txt = document.createElement(\"textarea\");\r\n  txt.innerHTML = html;\r\n  return txt.value;\r\n}\r\n\r\nfunction cacheData(key, data) {\r\n  console.log(\"Caching data for key: \", key);\r\n  return new Promise((resolve, reject) => {\r\n    chrome.storage.local.set({ [key]: data }, () => {\r\n      if (chrome.runtime.lastError) {\r\n        reject(chrome.runtime.lastError);\r\n      } else {\r\n        console.log(\"Data cached for key: \", key);\r\n        resolve();\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction getCachedData(key) {\r\n  console.log(\"Getting cached data for key: \", key);\r\n  return new Promise((resolve, reject) => {\r\n    chrome.storage.local.get(key, (result) => {\r\n      if (chrome.runtime.lastError) {\r\n        reject(chrome.runtime.lastError);\r\n      } else {\r\n        console.log(\"Cached data for key: \", key, result);\r\n        resolve(result[key]);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nexport { getChannelId, decodeHtml, cacheData, getCachedData};\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { getVideos, getVideoStats } from './api.js';\r\nimport { getChannelId } from './utils.js';\r\nimport { decodeHtml } from './utils.js';\r\n\r\n// Updates the popup with the most liked video and video with the highest like/view ratio\r\nasync function updatePopup(videos) {\r\n  console.log(\"Updating popup\");\r\n  let mostLikedVideos = Array(3).fill({ likes: 0, title: \"\", id: \"\" });\r\n  let highestRatioVideos = Array(3).fill({ ratio: 0, title: \"\", id: \"\" });\r\n\r\n  for (let video of videos) {\r\n    let stats = await getVideoStats(video.id.videoId);\r\n    let views = parseInt(stats.viewCount);\r\n    let likes = parseInt(stats.likeCount);\r\n    let id = video.id.videoId;\r\n    let ratio = likes / views;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      if (likes > mostLikedVideos[i].likes) {\r\n        mostLikedVideos.splice(i, 0, { likes, title: video.snippet.title, id: id });\r\n        mostLikedVideos.pop();\r\n        break;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      if (ratio > highestRatioVideos[i].ratio) {\r\n        highestRatioVideos.splice(i, 0, { ratio, title: video.snippet.title, id: id });\r\n        highestRatioVideos.pop();\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  let mostLikedList = document.getElementById(\"mostLikedList\");\r\n  let highestRatioList = document.getElementById(\"highestRatioList\");\r\n\r\n  // Clear the lists\r\n  mostLikedList.innerHTML = '';\r\n  highestRatioList.innerHTML = '';\r\n\r\n  await new Promise(resolve => setTimeout(resolve, 200));  // Temp pause to ensure its working\r\n\r\n  let baseVideoURL = \"https://www.youtube.com/watch?v=\";\r\n  for (let i = 0; i < 3; i++) {\r\n    let mostLikedItem = document.createElement('li');\r\n    mostLikedItem.innerHTML = `<a href=\"${baseVideoURL}${mostLikedVideos[i].id}\" target=\"_blank\">${decodeHtml(mostLikedVideos[i].title)}</a>`;\r\n    mostLikedList.appendChild(mostLikedItem);\r\n\r\n    let highestRatioItem = document.createElement('li');\r\n    highestRatioItem.innerHTML = `<a href=\"${baseVideoURL}${highestRatioVideos[i].id}\" target=\"_blank\">${decodeHtml(highestRatioVideos[i].title)}</a>`;\r\n    highestRatioList.appendChild(highestRatioItem);\r\n  }\r\n}\r\n\r\nasync function refreshData() {\r\n\r\n  // Get the current tab's URL\r\n  const tabs = await new Promise(resolve =>\r\n    chrome.tabs.query({ active: true, currentWindow: true }, resolve)\r\n  );\r\n  const url = new URL(tabs[0].url);\r\n\r\n  // Get the channelId\r\n  const channelId = await getChannelId(url);\r\n\r\n  // Clear the cache for this channel\r\n  await new Promise((resolve, reject) => {\r\n    chrome.storage.local.remove(channelId, () => {\r\n      if (chrome.runtime.lastError) {\r\n        reject(chrome.runtime.lastError);\r\n      } else {\r\n        resolve();\r\n      }\r\n    });\r\n  });\r\n\r\n  // Fetch new data and update the popup\r\n  const videos = await getVideos(channelId);\r\n  updatePopup(videos);\r\n}\r\n\r\nconsole.log(\"hello bitches\");\r\n\r\nchrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\r\n  var url = new URL(tabs[0].url);\r\n  getChannelId(url)\r\n    .then(channelId => getVideos(channelId))\r\n    .then(updatePopup)\r\n    .catch(console.error);\r\n});\r\n\r\nconsole.log(\"hello again bithces\");\r\ndocument.getElementById('refreshButton').addEventListener('click', refreshData);\r\n"],"names":[],"sourceRoot":""}